<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" style="height:100%">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>Google Maps JavaScript API Example</title>
    <script src="http://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"
      type="text/javascript"></script>
    <script type="text/javascript">

    var map;
    var mymarkers = [];
    var boundmarkers = [];
    var noflymarkers = [];
    var polyCoordinates = [];
    var boundary;
    var noflyzone;
    var boundMode;
    var noFlyMode;
    var valid;
    var infoWindow;

    var lines = [];

    function init(lat, lng) {
        var mapOptions = {
          zoom: 6,
          streetViewControl: false,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        
        map = new google.maps.Map(document.getElementById('map'), mapOptions);
        map.setCenter(new google.maps.LatLng(lat, lng),15);
        valid = 0;

        google.maps.event.addListener(map, 'click', function(e) {       
          myObject.set(e.latLng.lat().toFixed(6), e.latLng.lng().toFixed(6));

          if(boundMode == 1)
            valid = 0;

          else if(noFlyMode == 1)
            valid = 1;
        });

        infoWindow = new google.maps.InfoWindow();
        boundMode = 0;
        noFlyMode = 0;
    }

    var infowindow = new google.maps.InfoWindow();
    function markers(one, two, three, message) {

    var coordinates = new google.maps.LatLng(one,two);

    if(boundMode == 1) {
        if(valid == 0 && three != 2) {

            // make a function
            var string = 'Invalid Coordinates!';

            infowindow.setContent(string);
            infowindow.setPosition(coordinates);
            infowindow.open(map);

            return;
        }

    }

    else if(noFlyMode == 1) {
        if(valid == 0 && three != 1) {
        var latlng = coordinates;
        var string = 'Invalid Coordinates!';

        infowindow.setContent(string);
        infowindow.setPosition(latlng);
        infowindow.open(map);

        return;
        }
    }

    if(three == 0) {
        // create a marker at the given latitude and longitude
        var marker = new google.maps.Marker({
        position: coordinates,
        map: map
        });


        mymarkers.push(marker);
    }

    else if(three == 1) {

        var image = 'http://i1373.photobucket.com/albums/ag379/brynpnd/aircraftsmall_zps2ae10092.png';

        // create a marker at the given latitude and longitude
        var marker = new google.maps.Marker({
            position: coordinates,
            map: map,
            icon: image
        });

        boundmarkers.push(marker);
        polyCoordinates.push(coordinates);
    }

    else if(three == 2) {
        var image = 'http://i1373.photobucket.com/albums/ag379/brynpnd/skull_zps3cab915d.png';

        // create a marker at the given latitude and longitude
        var marker = new google.maps.Marker({
            position: coordinates,
            map: map,
            icon: image
        });

        noflymarkers.push(marker);
        polyCoordinates.push(coordinates);
    }

        // add the listener with the message to the marker
        google.maps.event.addListener(marker, 'click', (function(marker) {
         return function() {
                infowindow.setContent(message);
                infowindow.open(map, marker);
                }
        })(marker));


    }

    function removemarkers(one){
        if(one == 0) {
            for (var i = 0; i < mymarkers.length; i++ ) {
                mymarkers[i].setMap(null);
            }
            mymarkers = [];
        }

        if(one == 1) {
            for (var i = 0; i < boundmarkers.length; i++ ) {
                boundmarkers[i].setMap(null);
            }
            boundmarkers = [];
        }

        if(one == 2) {
            for (var i = 0; i < noflymarkers.length; i++ ) {
                noflymarkers[i].setMap(null);
            }
            noflymarkers = [];
        }

    }

    function removeLastMarker(mode, index) {

        if(mode == 1) {
            var length = boundmarkers.length;
            boundmarkers[length-1].setMap(null);
            boundmarkers.pop();
        }

        else if(mode == 2) {
            var length = noflymarkers.length;
            noflymarkers[length-1].setMap(null);
            noflymarkers.pop();
        }

        if(index > 0) {
            var linelength = lines.length;
            lines[linelength-1].setMap(null);
            lines.pop();
            polyCoordinates.pop();
        }

        else {
            removePolyCoords();
        }

    }

    function drawPolyLine(latone, lngone, lattwo, lngtwo, mode, index) {

        var coordOne = new google.maps.LatLng(latone,lngone);
        var coordTwo = new google.maps.LatLng(lattwo,lngtwo);

        var flightPlanCoordinates = [
            coordOne,
            coordTwo
        ];

        if(mode == 1) {
            var flightPath = new google.maps.Polyline({
            path: flightPlanCoordinates,
            geodesic: true,
            strokeColor: '#33FF00',
            strokeOpacity: 1.0,
            strokeWeight: 2
            });
        }

       if(mode == 2) {
            var flightPath = new google.maps.Polyline({
            path: flightPlanCoordinates,
            geodesic: true,
            strokeColor: '#FF0000',
            strokeOpacity: 1.0,
            strokeWeight: 2
            });
        }

        flightPath.setMap(map);

        lines.push(flightPath);
    }

    function removeLines() {

        for (var i = 0; i < lines.length; i++ ) {
            lines[i].setMap(null);
        }

        // clear previously drawn lines
        lines = [];
    }

    function drawPolygon(mode) {

        if(mode == 1) {
            boundary = new google.maps.Polygon({
                paths: polyCoordinates,
                strokeColor: '#33FF00',
                strokeOpacity: 0.8,
                strokeWeight: 3,
                fillColor: '#33FF00',
                fillOpacity: 0.35
            });

            boundary.setMap(map);
            boundMode = true;
            google.maps.event.addListener(boundary, 'click', boundListener);
        }

        if(mode == 2) {
            noflyzone = new google.maps.Polygon({
                paths: polyCoordinates,
                strokeColor: '#FF0000',
                strokeOpacity: 0.8,
                strokeWeight: 3,
                fillColor: '#FF0000',
                fillOpacity: 0.35
            });

            noflyzone.setMap(map);
            noFlyMode = true;
            google.maps.event.addListener(noflyzone, 'click', noflyListener);
        }

        removeLines();
        removePolyCoords();
    }

    function boundListener(event) {

/*
        var lat = event.latLng.lat();
        var lng = event.latLng.lng();
        var string = 'Coordinates: ' + lat + ', ' + lng;

        infoWindow.setContent(string);
        infoWindow.setPosition(event.latLng);
        infoWindow.open(map);
*/
        myObject.set(event.latLng.lat().toFixed(6), event.latLng.lng().toFixed(6));

        valid = 1;

    }

    function noflyListener(event) {
        myObject.set(event.latLng.lat().toFixed(6), event.latLng.lng().toFixed(6));

        valid = 0;

    }

    function allowdoubleclick() {
          google.maps.event.addListener(map, 'dblclick', function() {
            myObject.incNumClicks();
          });
    }

    function removePolyCoords() {
        polyCoordinates = [];
    }

    function inittest() {

    }

    </script>
  </head>

  <body style="height:100%" onload="init(21,-157);" topmargin="0" leftmargin="0">
    <div id="map" style="width:100% ; height:100%"></div>
  </body>
</html>

